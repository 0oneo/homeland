<% if @reply.errors.blank? %>
<% @page = 1 %>
  if($("#replies").length == 0){
    Turbolinks.visit(location.href);
  }
  else {
    var current_floor = parseInt($("#replies").data("last-floor")) + 1;
    var newNode = $('<%= j(render("reply", reply: @reply, reply_counter: @topic.replies_count - 1, display_edit: true)) %>');
    <% if @reply.parent_id %>
    if ($(".reply[data-parent-id=<%= @reply.parent_id %>]:last").length > 0) {
      $(".reply[data-parent-id=<%= @reply.parent_id %>]:last").after(newNode);
    } else {
      $(".reply[data-id=<%= @reply.parent_id %>]").after(newNode);
    }
    <% else %>
    $("#replies .items").append(newNode);
    <% end %>
    $("#replies .items").find(".total b").text('<%= @topic.replies_count %>');
    $("#replies").data("last-floor", current_floor);
    newNode.find(".reply-floor").text(current_floor + " æ¥¼");
    _topicView.replyCallback(1,'<%= j(@msg) %>');
  }
<% else %>
  _topicView.replyCallback(0,'<%= j(@msg) %>');
<% end %>
